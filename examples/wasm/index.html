<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoFetch WASM Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #007bff;
            padding-bottom: 10px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        #output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .loading {
            color: #666;
            font-style: italic;
        }
        .error {
            color: #dc3545;
        }
        .success {
            color: #28a745;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸš€ GoFetch WASM Demo</h1>
        <p>This demo showcases GoFetch running in the browser via WebAssembly.</p>
        
        <div>
            <button id="btnGetUsers" onclick="testGetUsers()">Get Users</button>
            <button id="btnGetUser" onclick="testGetUser()">Get User by ID</button>
            <button id="btnCreatePost" onclick="testCreatePost()">Create Post</button>
            <button id="btnWithInterceptor" onclick="testWithInterceptor()">Test Interceptor</button>
        </div>
        
        <div id="output">
            <div class="loading">Loading GoFetch WASM module...</div>
        </div>
    </div>

    <script src="wasm_exec.js"></script>
    <script>
        const output = document.getElementById('output');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : '';
            output.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }
        
        function clearOutput() {
            output.innerHTML = '';
        }

        // Load WASM module
        const go = new Go();
        WebAssembly.instantiateStreaming(fetch("gofetch.wasm"), go.importObject)
            .then((result) => {
                go.run(result.instance);
                clearOutput();
                log("âœ“ GoFetch WASM module loaded successfully!", 'success');
                log("Click a button to test the API calls.");
                
                // Enable buttons
                document.querySelectorAll('button').forEach(btn => btn.disabled = false);
            })
            .catch((error) => {
                log("âœ— Failed to load WASM module: " + error, 'error');
            });

        async function testGetUsers() {
            clearOutput();
            log("Fetching users from JSONPlaceholder API...");
            
            try {
                gofetch.setBaseURL("https://jsonplaceholder.typicode.com");
                const response = await gofetch.get("/users");
                
                log("âœ“ Success! Retrieved " + response.data.length + " users", 'success');
                log("\nFirst user:");
                log(JSON.stringify(response.data[0], null, 2));
                log("\nStatus Code: " + response.statusCode);
            } catch (error) {
                log("âœ— Error: " + error, 'error');
            }
        }

        async function testGetUser() {
            clearOutput();
            log("Fetching user with ID 1...");
            
            try {
                const client = gofetch.newClient();
                client.setBaseURL("https://jsonplaceholder.typicode.com");
                
                const response = await client.get("/users/1");
                
                log("âœ“ Success!", 'success');
                log("\nUser Details:");
                log(JSON.stringify(response.data, null, 2));
            } catch (error) {
                log("âœ— Error: " + error, 'error');
            }
        }

        async function testCreatePost() {
            clearOutput();
            log("Creating a new post...");
            
            try {
                const client = gofetch.newClient();
                client.setBaseURL("https://jsonplaceholder.typicode.com");
                client.setHeader("Content-Type", "application/json");
                
                const newPost = {
                    userId: 1,
                    title: "GoFetch WASM Test",
                    body: "This post was created using GoFetch running in WebAssembly!"
                };
                
                log("Sending POST request with body:");
                log(JSON.stringify(newPost, null, 2));
                
                const response = await client.post("/posts", null, newPost);
                
                log("\nâœ“ Success! Post created with ID: " + response.data.id, 'success');
                log("\nResponse:");
                log(JSON.stringify(response.data, null, 2));
            } catch (error) {
                log("âœ— Error: " + error, 'error');
            }
        }

        async function testWithInterceptor() {
            clearOutput();
            log("Testing with custom configuration...");
            
            try {
                const client = gofetch.newClient();
                client.setBaseURL("https://jsonplaceholder.typicode.com");
                client.setTimeout(5000);
                client.setHeader("X-Custom-Header", "GoFetch-WASM-Demo");
                
                log("Configuration:");
                log("  - Base URL: https://jsonplaceholder.typicode.com");
                log("  - Timeout: 5000ms");
                log("  - Custom Header: X-Custom-Header");
                log("\nMaking request...");
                
                const response = await client.get("/posts/1");
                
                log("\nâœ“ Success!", 'success');
                log("\nPost Details:");
                log(JSON.stringify(response.data, null, 2));
                log("\nResponse Headers:");
                log(JSON.stringify(response.headers, null, 2));
            } catch (error) {
                log("âœ— Error: " + error, 'error');
            }
        }
    </script>
</body>
</html>
